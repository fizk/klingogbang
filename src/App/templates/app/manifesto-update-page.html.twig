{% extends '@layout/default.html.twig' %}

{% block title %}Manifesto{% endblock %}

{% block style %}
    .drag-over {
        border: 1px solid transparent;
        padding: 16px;
    }
    .drag-over--active {
        border: 1px dashed #ced4da;
    }
    .image-list {
        list-style: none;
        padding-left: 0;
    }
    .image-list li {
        margin: 8px 0;
    }

{% endblock %}

{% block content %}
    <main>
        <form method="post" action="{{ path('new-manifesto') }}">
            <div class="row">
                <div class="col-9">
                    <div class="form-group">
                        <label for="body">Title</label>
                        <textarea class="form-control" id="body" name="body" rows="20">{{ manifesto.body is defined ? manifesto.body : null}}</textarea>
                        <small id="emailHelp" class="form-text text-muted">This field supports <a target="_blank" href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">markdown</a></small>
                    </div>
                </div>
                <div class="col-3">

                    <label for="body">Gallery</label>
                    <template id="gallery-result-entry">
                        <li>
                            <input type="hidden" name="gallery[]" />
                            <img src="#" />
                            <span></span>
                            <a href="#" onclick="removePoster(event)">(remove)</a>
                        </li>
                    </template>
                    <div class="form-group drag-over"
                         ondrop="onDropGallery(event)"
                         ondragover="isDragOver(event)"
                         ondragenter="isDragOver(event)"
                         ondragleave="isNotDragOver(event)"
                         ondragend="isNotDragOver(event)">
                        <p>
                            <a href="#" onclick="selectGallery(event)">Select or drag images</a>
                        </p>
                        <div class="progress" style="height: 2px;">
                            <div class="progress-bar" data-gallery-progress-bar
                                 role="progressbar" style="width: 0" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <small data-gallery-progress-bar-text class="form-text text-muted">&nbsp;</small>

                        <ul data-gallery class="image-list">
                            {% if manifesto.gallery is defined %}
                                {% for image in manifesto.gallery %}
                                    <li>
                                        <input type="hidden" name="gallery[]" value="{{ image.id }}">
                                        <img src="/img/thumb/{{ image.name }}" />
                                        <span>{{ image.name }}</span>
                                        <a href="#" onclick="removePoster(event)">(remove)</a>
                                    </li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <script>
                        const onDropGallery = (event) => {
                            event.preventDefault();
                            event.stopPropagation();
                            uploadImages(
                                event.dataTransfer.files,
                                '[data-gallery]',
                                '[data-gallery-progress-bar]',
                                '[data-gallery-progress-bar-text]',
                                '#gallery-result-entry'
                            );
                        };
                        const selectGallery = (event) => {
                            event.preventDefault();
                            const input = document.createElement('input');
                            input.type = 'file';
                            input.multiple = true;
                            input.accept = 'image/*';
                            input.style.position = 'absolute';
                            input.style.top = '-100px';
                            input.addEventListener('change', (event) => {
                                event.preventDefault();
                                uploadImages(
                                    event.target.files,
                                    '[data-gallery]',
                                    '[data-gallery-progress-bar]',
                                    '[data-gallery-progress-bar-text]',
                                    '#gallery-result-entry'
                                )
                            });
                            document.body.appendChild(input);
                            input.click();
                        };
                    </script>
                </div>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Submit</button>
                <a href="{{ path('about') }}">Cancel</a>
            </div>

        </form>
    </main>
{% endblock %}
